<!DOCTYPE html>
<html>
 <head>
  <title>My website</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/chartist.js/latest/chartist.min.js"></script>
 </head>
  <body>
		<div id= "images"></div>
                <img src= "ram.png" onclick="displayRamMetrics()"></img>
                <img src ="net.png" width ='96px' height='112px' onclick="displayNetworkMetrics()"></img>
 <form>
<h2>Graph Options:</h2>
<label><h4>Ram Options</h4></label>
<select id="ram_options" >
  <option value="Memory Available1">Memory Available</option>
  <option value="Swap Available 3">Swap Available</option>
</select>
<label><h4>CPU Options</h4></label>
</select>
<select id="cpu_options" >
  <option value="Clock Rate 1">Clock Rate</option>
  <option value="Temperature 2">CPU Temperature</option>
</select>
<form>


                <h3 align = 'center' id ="chart_title">Linux Metrics</h3>
                <div class = "ct-chart"></div>
                <div class = "tables"></div>
<script>
ramIndex = 1;
cpuIndex = 1;
cpuTitle = "Clock Rate";
ramTitle = "Memory Available";
document.getElementById("cpu_options").onchange = function() {
   cpuIndex = parseInt(this.value.slice(-1));
   cpuTitle = this.value.replace(" "+this.value.slice(-1), "");
};

document.getElementById("ram_options").onchange = function() {
   ramIndex = parseInt(this.value.slice(-1));
   ramTitle = this.value.replace(" "+this.value.slice(-1), "");
};


 getCol = function (matrix, col){
       var column = [];
       for(var i=0; i<matrix.length; i++){
          column.push(matrix[i][col]);
       }
       return column;
 }


displayRamMetrics = function(){
 $.ajax({
   type: 'get',
   url: 'getData.php',
   data: 'table=volatile_mem_stats',
      success: function(data) {
       var allData = CSVToArray(data, "," );
       jQuery('.tables').html('');
       $("h3").text("Ram Metric: " + ramTitle);
       headers = ['total memory', 'memory available', 'swap size', 'swap available', 'date & time'];
       allData.splice(-4);
       $(".tables").append(arrayToTable(allData, headers));
       new Chartist.Line('.ct-chart', {
  labels: getCol(allData, 4),
    series: [
     getCol(allData,ramIndex)
     ]
      }, {
        fullWidth: true,
        height: "400px",
        chartPadding: {
        bottom:100,
        left:50,
         }
       });
    }
      
  });
}

function arrayToTable(tableData, headers) {
    var table = $('<table align="center" border="1"></table>');
    var headerRow = $('<tr></tr>');
    for(i=0; i<headers.length; i++){
    headerRow.append('<th>' +headers[i] + '</th>');
    }
    table.append(headerRow);
    $(tableData).each(function (i, rowData) {
        var row = $('<tr></tr>');
        $(rowData).each(function (j, cellData) {
            row.append($('<td>'+cellData+'</td>'));
        });
        table.append(row);
    });
    return table;
}



displayNetworkMetrics = function(){
 $.ajax({
   type: 'get',
   url: 'numNetworkConns.php',
   data: 'table=c',
      success: function(data) {
       var allData = CSVToArray(data, "," );
       console.log(allData);
       jQuery('.tables').html('');
        $("h3").text("Number of connections");
       headers = ['number of connections', 'date & time'];
       allData.splice(-4);
       $(".tables").append(arrayToTable(allData, headers));
       new Chartist.Line('.ct-chart', {
  labels: getCol(allData, 1),
    series: [
     getCol(allData,0)
     ]
      }, {
        fullWidth: true,
        height: "400px",
        chartPadding: {
        bottom:100,
         }
       });
    }
      
  });
}



displayAllCPUs = function(id, rData, numThreads){
if(id < numThreads){
 $.ajax({
   type: 'get',
   url: 'getData.php',
   data: 'table=cpu_time_performance&where=cpu_number='+id,
      success: function(data) {
       var allData = CSVToArray(data, "," );
       allData.splice(-4);
       id++;
       rData.push(getCol(allData,cpuIndex));
       return displayAllCPUs(id,rData, numThreads);
  }
});
}else if(id == numThreads){
   $.ajax({
   type: 'get',
   url: 'getData.php',
   data: 'table=cpu_time_performance&where=cpu_number='+id,
      success: function(data) {
       var allData = CSVToArray(data, "," );
       allData.splice(-4);
       jQuery('.tables').html('');
       $("h3").text("CPU "+cpuTitle+ " (All Threads)");
        new Chartist.Line('.ct-chart', {
  labels: getCol(allData, cpuIndex),
    series:
     rData
      }, {
        fullWidth: true,
        height: "400px",
        chartPadding: {
        bottom:100,
         },
       });
   }

});
id++;
return displayAllCPUs(id, [], numThreads);
}else{
 $.ajax({
   type: 'get',
   url: 'getData.php',
   data: 'table=cpu_time_performance',
      success: function(data) {
       var allData = CSVToArray(data, "," );
       allData.splice(-4);
       jQuery('.tables').html('');
       headers = ['cpu number', 'current clock rate (mhz)', 'current temperature (c)','date & time'];
       $(".tables").append(arrayToTable(allData, headers));

  }
});

}

}


displayCPUChart = function(id, col){
 $.ajax({
   type: 'get',
   url: 'getData.php',
   data: 'table=cpu_time_performance&where=cpu_number='+id,
      success: function(data) {
       var allData = CSVToArray(data, "," );
       jQuery('.tables').html('');
       $("h3").text("CPU "+cpuTitle +" (CPU Thread " +id +")");
       headers = ['cpu number', 'current clock rate (mhz)', 'current temperature (c)','date & time'];
       allData.splice(-4);
       $(".tables").append(arrayToTable(allData, headers));
       new Chartist.Line('.ct-chart', {
  labels: getCol(allData, col),
    series: [
     getCol(allData,cpuIndex)
     ]
      }, {
        fullWidth: true,
        height: "400px",
        chartPadding: {
        bottom:100,
         }
       });
    }
      
  });
}

displayHDChart = function(id, col){
 $.ajax({
   type: 'get',
   url: 'getData.php',
   data: "table=persistent_storage_stats&where=disk_name='"+id.replace("-","/").replace("-","/").substring(3,id.length)+"'",
      success: function(data) {
       var allData = CSVToArray(data, "," );
       allData.splice(-4);
       jQuery('.tables').html('');
       $("h3").text("Available Space (Disk Partition " + id.replace("-","/").replace("-","/").substring(3,id.length) + ")");
       headers = ['partition name','space used', 'space available', 'date & time'];
       $(".tables").append(arrayToTable(allData, headers));
       new Chartist.Line('.ct-chart', {
  labels: getCol(allData, col),
    series: [
     getCol(allData,1)
     ]
      }, {
        fullWidth: true,
        height: "400px",
        chartPadding: {
        bottom:100,
         }
       });
    }
      
  });
}



initCPUS = function(){
  $.ajax({
    type: 'get',
    url: 'numCpus.php',
    data: 'table=cpu_info',
  	  success: function(data) {
        lines = data.split("|");
        for(i =0; i<parseInt(lines[0]); i++){
             $('#images')
               .prepend("<img id='cpu_"+i+"' src='cpu.jpg' width='160px' height='128px'/>");

             $('#cpu_'+i)
               .click(function(){ displayCPUChart(this.id.split("_")[1], 3);});

            
        }
       $('#images').prepend("<img id='all_cpus' src='multi-core-cpu.jpg' width='160px' height='128px'/>");
       numCPUs = parseInt(lines[0]);
       console.log(numCPUs);
       $('#all_cpus').click(function(){displayAllCPUs(0,[],numCPUs);});
    }
});
}

initHDS = function(){
  $.ajax({
    type: 'get',
    url: 'numHDs.php',
    data: 'table=cpu_info',
          success: function(data) {
        lines = CSVToArray(data, ",");
        for(i=0; i<(lines.length-1); i++){
         console.log(i);
             $('#images')
               .prepend("<img id='hd_"+lines[i][0]+"' src='hd.png' width='160px' height='128px'/>");

             $('#hd_'+lines[i][0])
               .click(function(){ displayHDChart(this.id, 3);});
          }
        }
    
});
}


initCPUS();
initHDS();




    function CSVToArray( strData, strDelimiter ){
        strDelimiter = (strDelimiter || ",");
        var objPattern = new RegExp(
            (
                "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
                "([^\"\\" + strDelimiter + "\\r\\n]*))"
            ),
            "gi"
            );
        var arrData = [[]];
        var arrMatches = null;
        while (arrMatches = objPattern.exec( strData )){
            var strMatchedDelimiter = arrMatches[ 1 ];
            if (
                strMatchedDelimiter.length &&
                strMatchedDelimiter !== strDelimiter
                ){
                arrData.push( [] );
            }
            var strMatchedValue;
            if (arrMatches[ 2 ]){
                strMatchedValue = arrMatches[ 2 ].replace(
                    new RegExp( "\"\"", "g" ),
                    "\""
                    );
            } else {
                strMatchedValue = arrMatches[ 3 ];
            }
            arrData[ arrData.length - 1 ].push( strMatchedValue );
        }
        return( arrData );
    }

</script>
 
 </body>
</html>
